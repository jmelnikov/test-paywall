# Тестовое задание для компании PayWall

## Ограничения тестового выполнения
- Везде используется одинаковые имя пользователя и пароль: `paywall`
- Пароли для MySQL установлены в файле `.env`, который загружен в репозиторий
- Для Redis пароль не установлен
- Порты в Docker открыты для доступа извне

## Запуск
1. Склонировать репозиторий
2. Перейти в папку docker, которая находится в корне репозитория
3. Выполнить команду `docker-compose up`
4. Установка зависимостей и миграция БД произойдет автоматически
5. Приложение будет доступно по адресу `http://localhost:8088`

## Использование
У приложения есть два роута:
1. `/test` - обрабатывает запрос, который был предоставлен в тестовом задании.
   - Формат запроса: `json`
   - Проверяет наличие необходимых полей в запросе
   - Выбрасывает исключения, если важные поля отсутствуют


2. `/test2` - обрабатывает запрос в стандартном формате.
   - Формат запроса: `x-www-form-urlencoded` или `form-data`
   - Принимает только два поля:
     - `user_id` - id пользователя в Telegram
     - `status` - статус платежа
   - Также проверяет наличие обязательных полей и выкидывает исключения, если они отсутствуют
   - Сейчас валидация наличия полей происходит в ручном режиме. Можно использовать валидацию через библиотеку `symfony/validator`, но тогда придётся изменить формат запроса.

### Отправка сообщений в Telegram
- Для отправки сообщений в Telegram необходимо установить переменную окружения `TELEGRAM_BOT_TOKEN` с токеном бота.
- Отправка реализована через стандартный Http Client.
- Отправка сообщений происходит через очередь, чтобы не блокировать основной поток приложения.
- Задержка перед каждой отправкой 100мс (1/10 секунды), чтобы не превысить лимиты Telegram API. _Это работает, если воркер только один. Если бы воркеров было несколько, нужно было бы использовать DelayStamp() для контроля скорости отправки сообщений._
- В случае ошибки при отправке сообщения, ошибка выводится в консоль.
